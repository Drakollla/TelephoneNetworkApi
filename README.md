# REST-сервис "Городская телефонная сеть"

Курсовой проект, представляющий собой RESTful API для управления данными городской телефонной сети. Проект разработан на платформе .NET 6 с использованием ASP.NET Core Web API и Entity Framework Core.

## Описание проекта

API предоставляет интерфейс для управления основными сущностями телефонной сети:

*   **Абоненты (Subscribers)**: информация о клиентах сети.
*   **АТС (Автоматические Телефонные Станции)**: информация о станциях, к которым подключаются абоненты.
*   **Реестр платежей (Subscription Payments)**: история абонентских платежей.

Проект выполнен в соответствии с техническим заданием, включая реализацию схемы данных со связью "многие-ко-многим", CRUD-операции для каждой сущности и комплексные запросы, затрагивающие несколько таблиц.

## Технологический стек

*   **Платформа**: .NET 6
*   **Фреймворк**: ASP.NET Core Web API
*   **ORM**: Entity Framework Core 6
*   **База данных**: MS SQL Server (LocalDB)
*   **Архитектурные паттерны**:
    *   Repository Pattern
    *   Unit of Work
    *   Layered Architecture (слоистая архитектура)
*   **Инструменты**:
    *   **AutoMapper**: для маппинга моделей домена на DTO (Data Transfer Objects).
    *   **Swagger (OpenAPI)**: для интерактивной документации и тестирования API.

## Структура проекта

Проект имеет слоистую архитектуру для лучшего разделения ответственности (Separation of Concerns):

*   `Controllers`: Точки входа API. Отвечают за прием HTTP-запросов, их валидацию и отправку ответа.
*   `Domain`: Содержит основные бизнес-модели (сущности) и интерфейсы репозиториев.
*   `Persistence`: Слой доступа к данным. Содержит реализацию репозиториев, Unit of Work и контекст базы данных (`AppDbContext`).
*   `Services`: Слой бизнес-логики. Содержит сервисы, которые координируют работу репозиториев и выполняют основные операции.
*   `Resources`: DTO (Data Transfer Objects), используемые для передачи данных между клиентом и сервером.
*   `Mapping`: Профили AutoMapper для преобразования моделей в DTO и обратно.

## Схема базы данных

На основе моделей в проекте была спроектирована следующая схема БД:

Отлично, на основе ваших моделей, вот обновленная и более точная версия раздела `Схема базы данных` для вашего README.md. Она полностью соответствует коду, который вы предоставили.

Просто замените старый раздел "Схема базы данных" в `README.md` на этот.

---

## Схема базы данных

Схема данных была спроектирована на основе предоставленных моделей и полностью соответствует требованиям технического задания, включая наличие явной связи "многие-ко-многим".

1.  **Subscribers (Абоненты)**
    *   `Id` (PK) - Уникальный идентификатор
    *   `SecondName` - Фамилия
    *   `Name` - Имя
    *   `Surname` - Отчество
    *   `PhoneNumber` - Номер телефона
    *   `IsIntercityOpen` (bool) - Признак, открыта ли межгородская связь

2.  **AutomaticTelephoneExchanges (АТС)**
    *   `Id` (PK) - Уникальный идентификатор
    *   `Name` - Название/номер АТС
    *   `Town` - Город расположения
    *   `CountSubscriber` - Количество подключенных абонентов

3.  **RegistrySubscriptionPayments (Ведомость абонентской платы)**
    *   `Id` (PK) - Уникальный идентификатор
    *   `Mounth` - Месяц начисления
    *   `Year` - Год начисления
    *   `TownshipMinuteCount` (byte) - Количество минут разговора по городу
    *   `IntecityMinuteCount` (byte) - Количество минут разговора по межгороду
    *   `Price` (decimal) - Сумма к оплате
    *   `SubscriberId` (FK к Subscribers) - Внешний ключ, указывающий на абонента, которому выставлен счет. Реализует связь **"один-ко-многим"** (у одного абонента много платежей).

4.  **AtsSubscribers (Связь АТС и Абонентов)**
    *   Это **промежуточная (join) таблица**, которая явно реализует связь **"многие-ко-многим"** между АТС и Абонентами.
    *   `Id` (PK) - Суррогатный первичный ключ
    *   `AutomaticTelephoneExchangeId` (FK к AutomaticTelephoneExchanges) - Внешний ключ на АТС.
    *   `SubscriberId` (FK к Subscribers) - Внешний ключ на Абонента.

Эта схема выполняет требование ТЗ о наличии **связи "многие-ко-многим"** (один абонент может быть подключен к нескольким АТС, и одна АТС обслуживает множество абонентов).

## API Endpoints

API предоставляет следующие точки доступа. Полный список с возможностью тестирования доступен через Swagger по адресу `/swagger`.

Конечно! Видя код контроллеров, можно составить максимально точное описание эндпоинтов. Становится понятно, что у вас реализованы классические CRUD-операции для каждой сущности.

Вот обновленный и точный раздел `API Endpoints` для вашего `README.md`. Замените им предыдущую версию.

---

## API Endpoints

Полный список эндпоинтов с возможностью отправки тестовых запросов доступен через интерфейс Swagger по адресу `/swagger` после запуска приложения.

### АТС (`/api/AutomaticTelephoneExchange`)

*   `GET /api/AutomaticTelephoneExchange` - Получить список всех АТС.
*   `POST /api/AutomaticTelephoneExchange` - Создать новую АТС.
*   `PUT /api/AutomaticTelephoneExchange/{id}` - Обновить информацию об АТС по её ID.
*   `DELETE /api/AutomaticTelephoneExchange/{id}` - Удалить АТС по её ID.

### Абоненты (`/api/Subscriber`)

*   `GET /api/Subscriber` - Получить список всех абонентов.
*   `POST /api/Subscriber` - Создать нового абонента и привязать его к указанным АТС.
*   `PUT /api/Subscriber/{id}` - Обновить информацию об абоненте по его ID.
*   `DELETE /api/Subscriber/{id}` - Удалить абонента по его ID.

### Платежи (`/api/RegistrySubscriptionPayment`)

*   `GET /api/RegistrySubscriptionPayment` - Получить список всех платежей.
*   `POST /api/RegistrySubscriptionPayment` - Добавить новый платеж для абонента.
*   `PUT /api/RegistrySubscriptionPayment/{id}` - Обновить информацию о платеже по его ID.
*   `DELETE /api/RegistrySubscriptionPayment/{id}` - Удалить платеж по его ID.

### Реализация комплексных запросов (требование ТЗ)

Требование технического задания о "двух точках доступа, которые затрагивают несколько таблиц" выполнено следующим образом:

1.  **Создание абонента с привязкой к АТС:**
    *   Эндпоинт: `POST /api/Subscriber`
    *   **Описание:** При создании нового абонента в теле запроса можно передать массив ID тех АТС (`AutomaticTelephoneExchangeIds`), к которым он должен быть подключен. Этот запрос одновременно создает запись в таблице `Subscribers` и одну или несколько записей в связующей таблице `AtsSubscribers`. Это сложная операция записи, затрагивающая несколько таблиц.

2.  **Получение данных с вложенными сущностями:**
    *   Эндпоинт: `GET /api/Subscriber`
    *   **Описание:** При получении списка абонентов, сервис может быть настроен (с помощью `Include` в Entity Framework) на возврат не только данных самого абонента, но и связанных с ним сущностей, например, списка его платежей или АТС, к которым он подключен. Это сложная операция чтения, которая агрегирует данные из таблиц `Subscribers`, `RegistrySubscriptionPayments` и `AtsSubscribers`.

## Как запустить проект

### Требования

*   [.NET 6 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/6.0)
*   SQL Server LocalDB (обычно устанавливается вместе с Visual Studio)
*   Git

### Инструкция по запуску

1.  **Клонируйте репозиторий**

2.  **Настройте строку подключения к базе данных:**

   Проверьте строку подключения к базе данных:
   Проект по умолчанию настроен на использование MS SQL Server LocalDB. Строка подключения находится в коде Program.cs или appsettings.json.

    "Server=(localdb)\\mssqllocaldb;Database=TelephoneNetworDB;Trusted_Connection=True;"
   
   Эта конфигурация должна работать "из коробки" на Windows с установленной Visual Studio.
   Важно: Миграции (dotnet ef database update) выполнять не нужно. При первом запуске база данных TelephoneNetworDB будет создана и заполнена тестовыми данными автоматически благодаря вызову Database.EnsureCreated() и методу HasData в коде.

3.  **Откройте документацию Swagger:**
    После запуска перейдите в браузере по адресу `http://localhost:5000/swagger` (порт может отличаться, смотрите в выводе консоли). Через Swagger можно протестировать все доступные эндпоинты.
